apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
namespace: peteq-app
namePrefix: local-
commonLabels:
  env: local
resources:
- postgres-client.yaml
- postgres.yaml
- init-job.yaml
- rabbitmq-instance.yaml
- ../../base
configMapGenerator:
- name: configmap
  behavior: merge
  envs:
  - env
patches:
  - target:
      group: getambassador.io
      kind: Mapping
      version: v2
      name: peteq-rest-api-service
    patch: |
      - op: replace
        path: "/spec/service"
        value: local-peteq-rest-api-service
  - target:
      group: getambassador.io
      kind: Mapping
      version: v2
      name: peteq-api-query
    patch: |
      - op: replace
        path: "/spec/service"
        value: local-peteq-query-service
  - target:
      group: getambassador.io
      kind: Mapping
      version: v2
      name: peteq-api-command
    patch: |
      - op: replace
        path: "/spec/service"
        value: local-peteq-command-service
  - path: patch-mapping-ui.yaml
    target:
      group: getambassador.io
      kind: Mapping
      version: v2
      name: peteq-ui
patchesJson6902:
  - path: patch-rabbitmq-envs.yaml
    target:
      group: apps
      version: v1
      kind: Deployment
      name: peteq-command-service
  - path: patch-rabbitmq-envs.yaml
    target:
      group: apps
      version: v1
      kind: Deployment
      name: peteq-query-service
  - path: patch-rabbitmq-envs.yaml
    target:
      group: apps
      version: v1
      kind: Deployment
      name: peteq-rest-api-service
  - path: patch-rabbitmq-envs.yaml
    target:
      group: apps
      version: v1
      kind: Deployment
      name: peteq-event-handler-service